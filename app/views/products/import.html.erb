<h1>Import products</h1>

<%= form_tag({action: :upload}, multipart: true) do %>
  <%= file_field_tag 'importing_products' %>
  <%= submit_tag %>
<% end %>

<% if @products.present? %>
  <table class="table">
    <thead>
      <tr>
        <th>Name</th>
        <th>Description</th>
        <th>Width</th>
        <th>Length</th>
        <th>Height</th>
        <th>Weight</th>
        <th>Value</th>
        <th colspan="3"></th>
      </tr>
    </thead>

    <tbody>
      <% @products.each do |item| %>
        <% product = item[:product] 
          error = item[:error]
          
          error_messages = error.messages.collect {|key, value|
            if value.length > 1
              message = value.join(" and ")
            else
              message = value.join()
            end
            
            "<strong>#{key}</strong> #{message}"
          }
        %>
        <tr class="<%= product.id.nil? ? 'danger' : 'success' %>">
          <td><%= product.name %></td>
          <td><%= product.description %></td>
          <td><%= product.width %></td>
          <td><%= product.length %></td>
          <td><%= product.height %></td>
          <td><%= product.weight %></td>
          <td><%= product.value %></td>
          <% if !product.id.nil? %>
            <td><%= link_to 'Show', product %></td>
            <td><%= link_to 'Edit', edit_product_path(product) %></td>
            <td><%= link_to 'Destroy', product, method: :delete, data: { confirm: 'Are you sure?' } %></td>
          <% else %>
            <td colspan="3"></td>
          <% end %>
        </tr>
        <% if product.id.nil? %>
          <tr class="danger"> 
            <td colspan="10">
              <%= error_messages.join("<br>").html_safe %>
            </td>
          </tr>
        <% end %>
      <% end %>
    </tbody>
  </table>
  <% end %>
